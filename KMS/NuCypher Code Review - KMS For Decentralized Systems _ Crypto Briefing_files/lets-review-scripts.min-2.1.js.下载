!function(e){"use strict";var t={init:function(){this.cacheDom(),this.cacheData(),this.bindEvents(),this.lightboxInit(),this.tooltipInit(),this.triggers(),1===parseInt(letsReview.letsReviewUReviews)&&this.sliderLoaders()},cacheDom:function(){this.$doc=e(document),this.$win=e(window),this.$body=e("body"),this.$tooltip=e(".lets-review-tip-f"),this.$lightbox=e(".lets-review-lightbox"),this.rtl=!!this.$body.hasClass("rtl"),this.$boxWrap=e(".lets-review-box-wrap"),this.$userRating=e('[id^="cb-user-rating-"]'),this.$formLabels=e(".lets-review-ur-onoff-label"),this.$lrForm=e(".lets-review-form"),1===parseInt(letsReview.letsReviewUReviews)&&(this.dataGather=e(".lets-review-form-crits:first").data(),this.$cSliders=e(".lets-review-c-slider"))},cacheData:function(){this.$winWidth=this.$win.width()},bindEvents:function(){this.$win.on("resize",this.resize.bind(this)),this.$body.on("click",this.$formLabels,this.formLabels),this.$body.on("click touchend","#swipebox-slider .current img",function(){return!1}).on("click touchend","#swipebox-slider .current",function(){e("#swipebox-close").trigger("click")}),this.$doc.on("slide",".lets-review-c-slider",this.slideIt),window.addEventListener?window.addEventListener("scroll",this.triggers.bind(this),!1):window.attachEvent("scroll",this.triggers.bind(this))},formLabels:function(){0!==t.$formLabels.length&&("on"===e(this).find("input[name=lets_review_ur_onoff]:checked").val()?t.$lrForm.slideDown(200):t.$lrForm.slideUp(200))},lightboxInit:function(){e.prototype.swipebox&&this.$lightbox.swipebox({hideBarsDelay:0})},tooltipInit:function(){this.$winWidth<767||this.$tooltip.tipper({direction:"bottom",follow:!0})},resize:function(e,t){this.cacheData(),this.tooltipInit()},triggers:function(t,i){e.each(this.$boxWrap.find(".cb-overlay span"),function(t,i){i=e(i),i.visible(!0)&&(i.removeClass("cb-trigger-zero"),i.closest(".lets-review-box-wrap").data("format")>2?i.addClass("cb-5-trigger"):i.addClass("cb-trigger"))})},slideIt:function(i,s){var a=e(this);a.next().val(s.value),a.next().hasClass("lets-review-ind-crit")&&t.scoreCalc(a.next())},sliderLoaders:function(){this.$cSliders.each(function(){var i=e(this);i.slider({min:0,max:t.dataGather.max,range:"min",step:t.dataGather.step,start:function(e,t){i.find(".ui-slider-range").css("background-color",i.data("color"))}})})},scoreCalc:function(i){var s,a=0,r=i.data("format"),o=i.closest(".lets-review-form-crits").find(".lets-review-all-crits .cb-cri-score"),n=i.closest(".lets-review-form-crits").find(".lets-review-final-score"),l=i.closest(".lets-review-form-crits").find(".lets-review-100");o.each(function(){a+=parseFloat(e(this).val())}),0===a&&n.val()>0||(s=1===parseInt(r)?Math.round(a/o.length):"on"===letsReview.doubleDecimalStars?(a/o.length).toFixed(2):Math.round(a/o.length*10)/10,isNaN(s)?(n.val(""),n.prev().slider("option",{max:t.dataGather.max,step:t.dataGather.step,value:n.val()})):(n.val(s),n.prev().slider("option",{max:t.dataGather.max,step:t.dataGather.step,value:s})),1===parseInt(r)?l.val(n.val()):2===parseInt(r)?l.val(10*n.val()):l.val(20*n.val()))}};t.init()}(jQuery),function(e){"use strict";var t,i,s,a,r,o,n,l,c,d,h,f,v,b,u,w,m,p,g,x=!1,$=e('[id^="cb-user-rating-"]'),y=Cookies.get("lets_review_user_rating");$.length&&$.each(function(){if(v=e(this),b=v.closest(".lets-review-box-wrap"),h=b.data("pid"),f=b.data("uid"),!(v.hasClass("cb-rated")||y instanceof Array&&(y.indexOf(h)>-1||y.indexOf(f)>-1))){switch(b.data("format")){case 1:u=v.find(".cb-bar");break;case 2:u=v.find(".cb-bar");break;default:u=v.find(".cb-overlay")}u.on("mousemove click mouseleave mouseenter",function(h){switch(v=e(this).closest('[id^="cb-user-rating-"]'),b=v.closest(".lets-review-box-wrap"),"mouseenter"===h.type&&(t=v.find(".cb-criteria"),d=t.html(),i=v.find(".cb-criteria-score"),s=i.data("cb-score-cache"),c=i.data("cb-width-cache"),o=v.find(".cb-overlay"),l=o.offset(),a=o.find("> span"),t.html(t.data("cb-txt"))),r=Math.ceil((h.pageX-l.left)/(o.width()/100)),n=x===!0?100-r:r,n>100&&(n=100),n<1&&(n=0),b.data("format")){case 1:p=n,g=!1;break;case 2:p=Math.round(10*n)/100,g=!1;break;default:p=Math.round(n/20*10)/10,g=!0}if(b.hasClass("cb-out-of-5")?a.stop().animate({width:100-n+"%"},15):a.stop().animate({width:n+"%"},15),i.html(p),"mouseleave"!==h.type&&"click"!==h.type||(b.hasClass("cb-out-of-5")?a.stop().animate({width:100-c+"%"},200):a.stop().animate({width:c+"%"},200),i.html(s),t.html(d)),"click"===h.type)return e(this).off("mousemove click mouseleave mouseenter"),v.addClass("cb-rated cb-lr-tip-f"),e.ajax({type:"POST",data:{action:"lets_review_a_cb",letsReviewNonce:letsReview.letsReviewNonce,letsReviewScore:n,letsReviewPostID:b.data("pid"),letsReviewFormat:b.data("format"),letsReviewUID:b.data("uid")},url:letsReview.letsReviewAUrl,dataType:"json",beforeSend:function(){w=b.data("type"),m=b.find(".cb-score-box"),v.addClass("cb-voting"),3===w&&g===!1&&m.addClass("cb-fs-voting")},success:function(e){o.find("> span").css("width",e[0]+"%"),v.find(".cb-votes-count").html(e[2]),i.html(e[1]),Cookies.set("lets_review_user_rating",e[3],{expires:7}),v.removeClass("cb-voting"),3===w&&g===!1&&(m.find(".cb-final-score").html(e[1]),m.removeClass("cb-fs-voting cb-score--")),v.tipper({direction:"bottom",follow:!0})},error:function(e,t,i){console.log("cbur "+e+" :: "+t+" :: "+i)}}),!1})}})}(jQuery);